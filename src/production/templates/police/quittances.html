{% extends 'police/menu_police.html' %}
{% load i18n %}
{% load my_filters %}
{% block extrastyle %} {% endblock %}
{% block content_title %}
    <div class="row mb-2">
          <div class="col-sm-6">
                <h4 class="m-0 f-bold">POLICE : N° {{ police.numero|default_if_none:"" }}</h4>
          </div>
          <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">{% trans 'Home' %}</a></li>
                    <li class="breadcrumb-item">Production</li>
                    <li class="breadcrumb-item"><a href="{% url 'clients' %}">Clients</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'police.details' police.id %}">Police</a></li>
                    <li class="breadcrumb-item active">Quittances</li>
                </ol>
          </div>
    </div>
{% endblock %}
{% block content %}
<div class="col-12 col-md-12 order-2 order-md-1">
  <div class="card">
    <div class="card-header">
        <h3 class="card-title text-white">{{_('QUITTANCES IMPAYEES')}}</h3>
    </div>
    <div class="card-body">
      <div class="button-link pull-right mb-2">
        {% if assureur_police.compagnie.has_taux_com %}
            <span id="btnOpenDialogAddQuittance" class="btn btn-sm btn-primary" data-toggle="modal" data-href="{% url 'add_quittance' police.id %}"><i class="fas fa-plus-circle"></i> {{_("Créer une quittance")}}</span>
            <span id="btnOpenDialogAddReglement" class="btn btn-sm btn-primary" data-toggle="modal" data-href="{% url 'add_reglement' police.id %}"><i class="fas fa-money-bill"></i> {{_("Faire un Règlement")}}</span>
          {% else %}
            <span class="btn btn-info"><a style="color:white;" target="_blank" href="../../../configurations/compagnie/">{{_("Veuillez parametrer les taux de com sur la compagnie")}}</a></span>
          {% endif %}
      </div>
      <div id="example1_wrapper" class="dataTables_wrapper dt-bootstrap4 ">
        <div class="row">
          <div class="col-12 col-md-12 col-sm-12 table-responsive">
            <table class="table table-bordered table-striped dataTable dtr-inline" id="table_quittances_impayees">
              <thead>
                <tr>
                  <th>#</th>
                  <th scope="col">{{_("N° Quittance")}}</th>
                  <th scope="col">{{_('Nature')}}</th>
                  <th scope="col">{{_('Type')}}</th>
                  <th scope="col">{{_("Date d'émission")}}</th>
                  <th scope="col">{{_("Début période")}}</th>
                  <th scope="col">{{_("Montant HT")}}</th>
                  <th scope="col">{{_("Montant TTC")}}</th>
                  <!--th scope="col">Mt cie</th-->
                  <th scope="col">{{_("Com Courtage")}}</th>
                  <th scope="col">{{_("Retro Apporteur")}}</th>
                  <th scope="col">{{_('Solde')}}</th>
                  <th scope="col">{{_('Devise')}}</th>
                  <th scope="col">{{_('Situation')}}</th>
                </tr>
              </thead>
              <tbody>
              {% for quittance_imp in quittances_impayees %}
                <tr>
                  <td><span class="badge badge-info btnOpenDialogDetailQuittance" data-href="{% url 'details_quittance' quittance_imp.id %}"><i class="fa fa-eye"></i></span></td>
                  <td>{{ quittance_imp.numero|default_if_none:"" }}</td>
                  <td>{{ quittance_imp.nature_quittance|default_if_none:"" }}</td>
                  <td>{{ quittance_imp.type_quittance|default_if_none:"" }}</td>
                  <td>{{ quittance_imp.date_emission|date:'d/m/Y'|default_if_none:"" }}</td>
                  <td>{{ quittance_imp.date_debut|date:'d/m/Y'|default_if_none:"" }}</td>
                  <td class="text-right">{{ quittance_imp.prime_ht|money_field }}</td>
                  <td class="text-right">{{ quittance_imp.prime_ttc|money_field }}</td>
                  <!--td class="text-right">{{ quittance_imp.montant_cie|money_field }}</td-->
                  <td class="text-right">{{ quittance_imp.commission_courtage|money_field }}</td>
                  <td class="text-right">{{ quittance_imp.commission_intermediaires|money_field }}</td>
                  <td class="text-right">{{ quittance_imp.solde|money_field }}</td>
                  <td>{{ quittance_imp.police.client.pays.devise.code|default_if_none:"" }}</td>
                  <td>{% if quittance_imp.statut == 'PAYE' %} {{_('SOLDEE')}} {% else %}{{ quittance_imp.statut|default_if_none:"" }}{% endif %}
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="col-12 col-md-12 order-2 order-md-1">
  <div class="card">
    <div class="card-header">
        <h3 class="card-title text-white">{{_('TOUTES LES QUITTANCES IMPAYEES')}}</h3>
    </div>
    <div class="card-body">
      <div class="button-link pull-right mb-2">

      </div>
      <div id="dataTables_wrapper" class="dataTables_wrapper dt-bootstrap4 ">
        <div class="row">
          <div class="col-12 col-md-12 col-sm-12 table-responsive">
            <table class="table table-bordered table-striped dataTable dtr-inline" id="table_quittances">
              <thead>
                <tr>
                  <th>#</th>
                  <th scope="col">{{_("N° Quittance")}}</th>
                  <th scope="col">{{_('Nature')}}</th>
                  <th scope="col">{{_('Type')}}</th>
                  <th scope="col">{{_("Date d'émission")}}</th>
                  <th scope="col">{{_("Début période")}}</th>
                  <th scope="col">{{_("Montant HT")}}</th>
                  <th scope="col">{{_("Montant TTC")}}</th>
                  <!--th scope="col">Mt cie</th-->
                  <th scope="col">{{_("Com Courtage")}}</th>
                  <th scope="col">{{_("Retro Apporteur")}}</th>
                  <th scope="col">{{_('Solde')}}</th>
                  <th scope="col">{{_('Devise')}}</th>
                  <th scope="col">{{_('Situation')}}</th>
                </tr>
              </thead>
              <tbody>
              {% for quittance in quittances %}
                <tr>
                  <td><span class="badge badge-info btnOpenDialogDetailQuittance" data-href="{% url 'details_quittance' quittance.id %}"><i class="fa fa-eye"></i></span></td>
                  <td>{{ quittance.numero|default_if_none:"" }}</td>
                  <td>{{ quittance.nature_quittance|default_if_none:"" }}</td>
                  <td>{{ quittance.type_quittance|default_if_none:"" }}</td>
                  <td>{{ quittance.date_emission|date:'d/m/Y'|default_if_none:"" }}</td>
                  <td>{{ quittance.date_debut|date:'d/m/Y'|default_if_none:"" }}</td>
                  <td class="text-right">{{ quittance.prime_ht|money_field }}</td>
                  <td class="text-right">{{ quittance.prime_ttc|money_field }}</td>
                  <!--td class="text-right">{{ quittance.montant_cie|money_field }}</td-->
                  <td class="text-right">{{ quittance.commission_courtage|money_field }}</td>
                  <td class="text-right">{{ quittance.commission_intermediaires|money_field }}</td>
                  <td class="text-right">{{ quittance.solde|money_field }}</td>
                  <td>{{ quittance.police.client.pays.devise.code|default_if_none:"" }}</td>
                  <td>{% if quittance.statut == 'PAYE' %} {{_('SOLDEE')}} {% else %}{{ quittance.statut|default_if_none:"" }}{% endif %}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="col-12 col-md-12 order-2 order-md-1">
  <div class="card">
    <div class="card-header">
        <h3 class="card-title text-white">{{_('HONORAIRES')}}</h3>
    </div>
    <div class="card-body">
      <div class="button-link pull-right mb-2">

      </div>
      <div id="dataTables_wrapper" class="dataTables_wrapper dt-bootstrap4 ">
        <div class="row">
          <div class="col-12 col-md-12 col-sm-12 table-responsive">
            <table class="table table-bordered table-striped dataTable dtr-inline" id="table_honoraires">
                <thead>
                  <tr>
                    <th>#</th>
                    <th scope="col">{{_("N° Quittance")}}</th>
                    <th scope="col">{{_('Nature')}}</th>
                    <th scope="col">{{_('Type')}}</th>
                    <th scope="col">{{_("Date d'émission")}}</th>
                    <th scope="col">{{_("Début période")}}</th>
                    <th scope="col">{{_("Montant HT")}}</th>
                    <th scope="col">{{_("Montant TTC")}}</th>
                    <th scope="col">{{_("Com Courtage")}}</th>
                    <th scope="col">{{_('Solde')}}</th>
                    <th scope="col">{{_('Devise')}}</th>
                    <th scope="col">{{_('Situation')}}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for honoraire in quittances_honoraires %}
                    <tr>
                      <td><span class="badge badge-info btnOpenDialogDetailQuittance" data-href="{% url 'details_quittance' honoraire.id %}"><i class="fa fa-eye"></i></span></td>
                      <td>{{ honoraire.numero|default_if_none:"" }}</td>
                      <td>{{ honoraire.nature_quittance|default_if_none:"" }}</td>
                      <td>{{ honoraire.type_quittance|default_if_none:"" }}</td>
                      <td>{{ honoraire.date_emission|date:'d/m/Y'|default_if_none:"" }}</td>
                      <td>{{ honoraire.date_debut|date:'d/m/Y'|default_if_none:"" }}</td>
                      <td class="text-right">{{ honoraire.prime_ht|money_field }}</td>
                      <td class="text-right">{{ honoraire.prime_ttc|money_field }}</td>
                      <td class="text-right">{{ honoraire.commission_courtage|money_field }}</td>
                      <td class="text-right">{{ honoraire.solde|money_field }}</td>
                      <td>{{ honoraire.police.client.pays.devise.code|default_if_none:"" }}</td>
                      <td>{% if honoraire.statut == 'PAYE' %} {{_('SOLDEE')}} {% else %}{{ honoraire.statut|default_if_none:"" }}{% endif %}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="col-12 col-md-12 order-2 order-md-1">
  <div class="card">
    <div class="card-header">
        <h3 class="card-title text-white">{{_('EMISSIONS')}}</h3>
    </div>
    <div class="card-body">
      <div class="button-link pull-right mb-2">

      </div>
      <div id="dataTables_wrapper" class="dataTables_wrapper dt-bootstrap4 ">
        <div class="row">
          <div class="col-12 col-md-12 col-sm-12 table-responsive">
            <table class="table table-bordered table-striped dataTable dtr-inline" id="table_emissions">
                <thead>
                  <tr>
                    <th>#</th>
                    <th scope="col">{{_("N° Quittance")}}</th>
                    <th scope="col">{{_('Nature')}}</th>
                    <th scope="col">{{_('Type')}}</th>
                    <th scope="col">{{_("Date d'émission")}}</th>
                    <th scope="col">{{_("Début période")}}</th>
                    <th scope="col">{{_("Montant HT")}}</th>
                    <th scope="col">{{_("Montant TTC")}}</th>
                    <th scope="col">{{_("Com Courtage")}}</th>
                    <th scope="col">{{_('Solde')}}</th>
                    <th scope="col">{{_('Devise')}}</th>
                    <th scope="col">{{_('Situation')}}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for emission in quittances_emissions %}
                    <tr>
                      <td><span class="badge badge-info btnOpenDialogDetailQuittance" data-href="{% url 'details_quittance' emission.id %}"><i class="fa fa-eye"></i></span></td>
                      <td>{{ emission.numero|default_if_none:"" }}</td>
                      <td>{{ emission.nature_quittance|default_if_none:"" }}</td>
                      <td>{{ emission.type_quittance|default_if_none:"" }}</td>
                      <td>{{ emission.date_emission|date:'d/m/Y'|default_if_none:"" }}</td>
                      <td>{{ emission.date_debut|date:'d/m/Y'|default_if_none:"" }}</td>
                      <td class="text-right">{{ emission.prime_ht|money_field }}</td>
                      <td class="text-right">{{ emission.prime_ttc|money_field }}</td>
                      <td class="text-right">{{ emission.commission_courtage|money_field }}</td>
                      <td class="text-right">{{ emission.solde|money_field }}</td>
                      <td>{{ emission.police.client.pays.devise.code|default_if_none:"" }}</td>
                      <td>{% if emission.statut == 'PAYE' %} {{_('SOLDEE')}} {% else %}{{ emission.statut|default_if_none:"" }}{% endif %}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="col-12 col-md-12 order-2 order-md-1">
  <div class="card">
    <div class="card-header">
        <h3 class="card-title text-white">{{_('LES QUITTANCES ANNULEES')}}</h3>
    </div>
    <div class="card-body">
      <div class="button-link pull-right mb-2">

      </div>
      <div id="dataTables_wrapper" class="dataTables_wrapper dt-bootstrap4 ">
        <div class="row">
          <div class="col-12 col-md-12 col-sm-12 table-responsive">
            <table class="table table-bordered table-striped dataTable dtr-inline" id="table_quittances_annulees">
              <thead>
                <tr>
                  <th>#</th>
                  <th scope="col">{{_("N° Quittance")}}</th>
                  <th scope="col">{{_("Nature")}}</th>
                  <th scope="col">{{_("Type")}}</th>
                  <th scope="col">{{_("Date d'émission")}}</th>
                  <th scope="col">{{_("Début période")}}</th>
                  <th scope="col">{{_("Montant HT")}}</th>
                  <th scope="col">{{_("Montant TTC")}}</th>
                  <th scope="col">{{_("Com Courtage")}}</th>
                  <th scope="col">{{_("Retro Apporteur")}}</th>
                  <th scope="col">{{_('Solde')}}</th>
                  <th scope="col">{{_('Devise')}}</th>
                  <th scope="col">{{_('Situation')}}</th>
                  <th scope="col">{{_('Statut')}}</th>
                </tr>
              </thead>
              <tbody>
                {% for qa in quittances_annulees %}
                  <tr>
                    <td><span class="badge badge-info btnOpenDialogDetailQuittance" data-href="{% url 'details_quittance' qa.id %}"><i class="fa fa-eye"></i></span></td>
                    <td>{{ qa.numero|default_if_none:"" }}</td>
                    <td>{{ qa.nature_quittance|default_if_none:"" }}</td>
                    <td>{{ qa.type_quittance|default_if_none:"" }}</td>
                    <td>{{ qa.date_emission|date:'d/m/Y'|default_if_none:"" }}</td>
                    <td>{{ qa.date_debut|date:'d/m/Y'|default_if_none:"" }}</td>
                    <td class="text-right">{{ qa.prime_ht|money_field }}</td>
                    <td class="text-right">{{ qa.prime_ttc|money_field }}</td>
                    <td class="text-right">{{ qa.commission_courtage|money_field }}</td>
                    <td class="text-right">{{ qa.commission_intermediaires|money_field }}</td>
                    <td class="text-right">{{ qa.solde|money_field }}</td>
                    <td>{{ qa.police.client.pays.devise.code|default_if_none:"" }}</td>
                    <td>{% if qa.statut == 'PAYE' %} {{_('SOLDEE')}} {% else %}{{ qa.statut|default_if_none:"" }}{% endif %}</td>
                    <td><span class="badge badge-danger">{{ qa.statut_validite|default_if_none:"" }}</span></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extrajs %}
<script>
    $(document).ready(function() {
        $('#quittance').removeClass('o-bg-primary');
        $('#quittance').addClass('o-active');
    } );
</script>
{% endblock %}
